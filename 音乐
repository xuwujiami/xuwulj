#!/bin/bash

# 音乐文件所在目录
music_dir="$HOME/xuwulj/"

# 检查目录是否存在
if [ ! -d "$music_dir" ]; then
    echo -e "\033[1;31m错误：音乐目录 $music_dir 不存在，请检查路径！\033[0m"
    exit 1
fi

# 查找目录下的常见音频文件（可根据需要扩展支持的格式）
music_files=$(find "$music_dir" -type f \( -name "*.mp3" -o -name "*.flac" -o -name "*.wav" -o -name "*.ogg" \))

# 检查是否找到音乐文件
if [ -z "$music_files" ]; then
    echo -e "\033[1;33m提示：音乐目录 $music_dir 下未找到支持的音频文件（mp3、flac、wav、ogg 等）\033[0m"
    exit 1
fi

# 选择要播放的音乐文件（简单列出让用户选，这里选第一个示例，也可改成循环选多个等逻辑 ）
echo -e "\033[1;32m找到以下音乐文件：\033[0m"
echo "$music_files" | awk '{print NR ". " $0}'
echo -e "\033[1;33m请输入要播放的音乐序号（默认播放第一个，直接回车即可）：\033[0m"
read select_num

if [ -z "$select_num" ] || [ "$select_num" -eq 1 2>/dev/null ]; then
    selected_music=$(echo "$music_files" | head -n 1)
else
    selected_music=$(echo "$music_files" | sed -n "${select_num}p")
fi

# 使用 mpv 后台播放音乐，& 符号实现后台运行，--no-video 关闭视频显示（针对带视频的音频文件）
echo -e "\033[1;32m开始后台播放音乐：$selected_music\033[0m"
mpv --no-video --quiet "$selected_music" &

# 获取后台进程 PID 并提示
play_pid=$!
echo -e "音乐播放进程已在后台运行，进程 PID 为：\033[1;34m$play_pid\033[0m"
echo -e "若要停止播放，可执行 \033[1;35mkill $play_pid\033[0m 命令"